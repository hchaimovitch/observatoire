{"ast":null,"code":"import _classCallCheck from \"C:\\\\work\\\\Project\\\\reactJs\\\\observatoire\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\work\\\\Project\\\\reactJs\\\\observatoire\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\work\\\\Project\\\\reactJs\\\\observatoire\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\work\\\\Project\\\\reactJs\\\\observatoire\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\work\\\\Project\\\\reactJs\\\\observatoire\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\work\\\\Project\\\\reactJs\\\\observatoire\\\\src\\\\components\\\\type\\\\chart.jsx\";\n//import './style.css';\nimport React from 'react';\nimport * as d3 from 'd3';\n\nvar Chart =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Chart, _React$Component);\n\n  function Chart(props) {\n    var _this;\n\n    _classCallCheck(this, Chart);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Chart).call(this, props));\n    _this.state = {\n      data: '',\n      svgNodeRender: ''\n    };\n    return _this;\n  }\n\n  _createClass(Chart, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var that = this;\n      d3.json(\"./flare.json\").then(function (json) {\n        var data = json;\n        console.log(\"data : \" + data);\n\n        var partition = function partition(data) {\n          return d3.partition().size([2 * Math.PI, radius])(d3.hierarchy(data).sum(function (d) {\n            return d.size;\n          }).sort(function (a, b) {\n            return b.value - a.value;\n          }));\n        };\n\n        var color = d3.scaleOrdinal().range(d3.quantize(d3.interpolateRainbow, data.children.length + 1));\n        var format = d3.format(\",d\");\n        var width = 932;\n        var radius = width / 2;\n        var arc = d3.arc() // d is not define\n        // https://www.dashingd3js.com/svg-paths-and-d3js\n        // The shape of an SVG Path element is defined by one attribute: d.\n        //This attribute, d, contains a series of commands and parameters in the SVG Path Mini-Language. \n        .startAngle(function (d) {\n          return d.x0;\n        }).endAngle(function (d) {\n          return d.x1;\n        }).padAngle(function (d) {\n          return Math.min((d.x1 - d.x0) / 2, 0.005);\n        }).padRadius(radius / 2).innerRadius(function (d) {\n          return Math.sqrt(d.y0);\n        }).outerRadius(function (d) {\n          return Math.sqrt(d.y1 - 1);\n        });\n        /*\r\n                        var arc = d3.arc()\r\n                        .startAngle(function(d) { return d.x0; })\r\n                        .endAngle(function(d) { return d.x1; })\r\n                        .innerRadius(function(d) { return Math.sqrt(d.y0); })\r\n                        .outerRadius(function(d) { return Math.sqrt(d.y1); });\r\n                        */\n\n        var root = partition(data);\n        var svg = d3.select(\"#type\").style(\"width\", \"100%\").style(\"height\", \"auto\").style(\"padding\", \"10px\").style(\"font\", \"10px sans-serif\").style(\"box-sizing\", \"border-box\");\n        var g = svg.append(\"g\");\n        g.append(\"g\").attr(\"fill-opacity\", 0.6).selectAll(\"path\").data(root.descendants().filter(function (d) {\n          return d.depth;\n        })).enter().append(\"path\").attr(\"fill\", function (d) {\n          while (d.depth > 1) {\n            d = d.parent;\n          }\n\n          return color(d.data.name);\n        }).attr(\"d\", arc).append(\"title\").text(function (d) {\n          return \"\".concat(d.ancestors().map(function (d) {\n            return d.data.name;\n          }).reverse().join(\"/\"), \"\\n\").concat(format(d.value));\n        });\n        g.append(\"g\").attr(\"pointer-events\", \"none\").attr(\"text-anchor\", \"middle\").selectAll(\"text\").data(root.descendants().filter(function (d) {\n          return d.depth && (d.y0 + d.y1) / 2 * (d.x1 - d.x0) > 10;\n        })).enter().append(\"text\").attr(\"transform\", function (d) {\n          var x = (d.x0 + d.x1) / 2 * 180 / Math.PI;\n          var y = (d.y0 + d.y1) / 2;\n          return \"rotate(\".concat(x - 90, \") translate(\").concat(y, \",0) rotate(\").concat(x < 180 ? 0 : 180, \")\");\n        }).attr(\"dy\", \"0.35em\").text(function (d) {\n          return d.data.name;\n        }); // test\n        //document.body.appendChild(svg.node());\n\n        console.log(g.node()); //const box = g.node().getBBox(); Bug with chrome\n\n        var box = g.node().getBoundingClientRect();\n        console.log(\" box : \" + JSON.stringify(box));\n        svg.remove().attr(\"width\", box.width).attr(\"height\", box.height).attr(\"viewBox\", \"\".concat(box.x, \" \").concat(box.y, \" \").concat(box.width, \" \").concat(box.height)); //svg.node() replace by\n\n        document.body.appendChild(svg.node());\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Chart;\n}(React.Component);\n\nexport default Chart;","map":{"version":3,"sources":["C:\\work\\Project\\reactJs\\observatoire\\src\\components\\type\\chart.jsx"],"names":["React","d3","Chart","props","state","data","svgNodeRender","that","json","then","console","log","partition","size","Math","PI","radius","hierarchy","sum","d","sort","a","b","value","color","scaleOrdinal","range","quantize","interpolateRainbow","children","length","format","width","arc","startAngle","x0","endAngle","x1","padAngle","min","padRadius","innerRadius","sqrt","y0","outerRadius","y1","root","svg","select","style","g","append","attr","selectAll","descendants","filter","depth","enter","parent","name","text","ancestors","map","reverse","join","x","y","node","box","getBoundingClientRect","JSON","stringify","remove","height","document","body","appendChild","Component"],"mappings":"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","sourcesContent":["//import './style.css';\r\nimport React from 'react';\r\nimport * as d3 from 'd3';\r\n\r\nclass Chart extends React.Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            data : '',\r\n            svgNodeRender : ''\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        let that = this;\r\n        d3.json(\"./flare.json\").then(function(json) {\r\n        \r\n            const data = json\r\n        \r\n            console.log(\"data : \" + data);\r\n              \r\n            const partition = data => d3.partition()\r\n                .size([2 * Math.PI, radius])(d3.hierarchy(data)\r\n                .sum(d => d.size)\r\n                .sort((a, b) => b.value - a.value));\r\n            const color = d3.scaleOrdinal().range(d3.quantize(d3.interpolateRainbow, data.children.length + 1));\r\n            const format = d3.format(\",d\");\r\n            const width = 932;\r\n            const radius = width / 2;\r\n            const arc = d3.arc()\r\n            // d is not define\r\n            // https://www.dashingd3js.com/svg-paths-and-d3js\r\n            // The shape of an SVG Path element is defined by one attribute: d.\r\n            //This attribute, d, contains a series of commands and parameters in the SVG Path Mini-Language. \r\n                .startAngle(function(d) { return d.x0; })\r\n                .endAngle(function(d) { return d.x1; })\r\n                .padAngle(function(d) { return Math.min((d.x1 - d.x0) / 2, 0.005) })\r\n                .padRadius(radius / 2)\r\n                .innerRadius(function(d) { return Math.sqrt(d.y0); })\r\n                .outerRadius(function(d) { return Math.sqrt(d.y1 - 1); });\r\n/*\r\n                var arc = d3.arc()\r\n                .startAngle(function(d) { return d.x0; })\r\n                .endAngle(function(d) { return d.x1; })\r\n                .innerRadius(function(d) { return Math.sqrt(d.y0); })\r\n                .outerRadius(function(d) { return Math.sqrt(d.y1); });\r\n                */\r\n            const root = partition(data);      \r\n            const svg = d3.select(\"#type\")\r\n                .style(\"width\", \"100%\")\r\n                .style(\"height\", \"auto\")\r\n                .style(\"padding\", \"10px\")\r\n                .style(\"font\", \"10px sans-serif\")\r\n                .style(\"box-sizing\", \"border-box\");\r\n              \r\n            const g = svg.append(\"g\");\r\n            \r\n            g.append(\"g\")\r\n                .attr(\"fill-opacity\", 0.6)\r\n              .selectAll(\"path\")\r\n              .data(root.descendants().filter(d => d.depth))\r\n              .enter().append(\"path\")\r\n                .attr(\"fill\", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })\r\n                .attr(\"d\", arc)\r\n              .append(\"title\")\r\n                .text(d => `${d.ancestors().map(d => d.data.name).reverse().join(\"/\")}\\n${format(d.value)}`);\r\n          \r\n            g.append(\"g\")\r\n                .attr(\"pointer-events\", \"none\")\r\n                .attr(\"text-anchor\", \"middle\")\r\n              .selectAll(\"text\")\r\n              .data(root.descendants().filter(d => d.depth && (d.y0 + d.y1) / 2 * (d.x1 - d.x0) > 10))\r\n              .enter().append(\"text\")\r\n                .attr(\"transform\", function(d) {\r\n                  const x = (d.x0 + d.x1) / 2 * 180 / Math.PI;\r\n                  const y = (d.y0 + d.y1) / 2;\r\n                  return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;\r\n                })\r\n                .attr(\"dy\", \"0.35em\")\r\n                .text(d => d.data.name);\r\n        \r\n\r\n                // test\r\n                //document.body.appendChild(svg.node());\r\n            \r\n                console.log( g.node() );\r\n                \r\n                //const box = g.node().getBBox(); Bug with chrome\r\n                const box = g.node().getBoundingClientRect();\r\n        \r\n                console.log( \" box : \" + JSON.stringify(box) );\r\n            \r\n                svg.remove()\r\n                    .attr(\"width\", box.width)\r\n                    .attr(\"height\", box.height)\r\n                    .attr(\"viewBox\", `${box.x} ${box.y} ${box.width} ${box.height}`);\r\n\r\n                //svg.node() replace by\r\n                document.body.appendChild(svg.node());\r\n            });\r\n    }\r\n\r\n    render() {\r\n        return <div></div>\r\n        \r\n    }\r\n}\r\n\r\nexport default Chart;"]},"metadata":{},"sourceType":"module"}